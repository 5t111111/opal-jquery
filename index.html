<!DOCTYPE html>
<html>
<head>
  <title>opal-jquery</title>
  <link rel="stylesheet" href="css/bootstrap.css" type="text/css">
  <link rel="stylesheet" href="css/pygment_trac.css" type="text/css">
  <style>
    body {
      padding-top: 42px;
    }
  </style>
</head>
<body>
  <a href="https://github.com/opal/opal-jquery"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
  <div class="container">
    <div class="page-header">
      <h1>opal-jquery <small>jquery wrapper for opal</small></h1>
    </div><p>opal-jquery provides DOM access to opal by wrapping jquery (or zepto)
and providing a nice ruby syntax for dealing with jquery instances.
opal-jquery is <a href="http://github.com/opal/opal-jquery">hosted on github</a>.</p>

<p>jQuery instances are toll-free bridged to instances of the ruby class
<code>JQuery</code>, so they can be used interchangeably. The <code>Document</code> module also
exists, which provides the simple top level css selector method:</p>
<div class="highlight"><pre><span class="n">elements</span> <span class="o">=</span> <span class="no">Document</span><span class="o">[</span><span class="s1">&#39;.foo&#39;</span><span class="o">]</span>
<span class="c1"># =&gt; [&lt;div class=&quot;foo&quot;&gt;, ...]</span>

<span class="n">elements</span><span class="o">.</span><span class="n">class</span>
<span class="c1"># =&gt; JQuery</span>

<span class="n">elements</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">alert</span> <span class="s2">&quot;element was clicked&quot;</span>
<span class="k">end</span>
</pre>
</div>

<h3>Getting Started</h3>

<h4>Installation</h4>

<p>Install opal-jquery from RubyGems:</p>
<div class="highlight"><pre>$ gem install opal-jquery
</pre>
</div>

<p>Or include it in your Gemfile for Bundler:</p>
<div class="highlight"><pre><span class="n">gem</span> <span class="s1">&#39;opal-jquery&#39;</span>
</pre>
</div>

<h3>Interacting with the DOM</h3>

<h4>Finiding elements</h4>

<p>opal-jquery provides the <code>Document</code> module, which is the best way to
find elements by css selector:</p>
<div class="highlight"><pre><span class="no">Document</span><span class="o">[</span><span class="s1">&#39;#header&#39;</span><span class="o">]</span>
</pre>
</div>

<p>This method acts just like <code>$(&#39;selector&#39;)</code>, and can use any jquery
compatible selector:</p>
<div class="highlight"><pre><span class="no">Document</span><span class="o">[</span><span class="s1">&#39;#navigation li:last&#39;</span><span class="o">]</span>
</pre>
</div>

<p>The result is just a jquery instance, which is toll-free bridged to
instances of the <code>Element</code> class in ruby:</p>
<div class="highlight"><pre><span class="no">Document</span><span class="o">[</span><span class="s1">&#39;.foo&#39;</span><span class="o">].</span><span class="n">class</span>
<span class="c1"># =&gt; Element</span>
</pre>
</div>

<p>Instances of <code>Element</code> also have the <code>#find</code> method available for
finding elements within the scope of each dom node represented by
the instance:</p>
<div class="highlight"><pre><span class="n">el</span> <span class="o">=</span> <span class="no">Document</span><span class="o">[</span><span class="s1">&#39;#header&#39;</span><span class="o">]</span>
<span class="n">el</span><span class="o">.</span><span class="n">find</span> <span class="s1">&#39;.foo&#39;</span>
<span class="c1"># =&gt; #&lt;Element .... &gt;</span>
</pre>
</div>

<h4>Running code on document ready</h4>

<p>Just like jquery, opal-jquery requires the document to be ready to
be able to fully interact with the page. Any top level access should
use the <code>ready?</code> method:</p>
<div class="highlight"><pre><span class="no">Document</span><span class="o">.</span><span class="n">ready?</span> <span class="k">do</span>
  <span class="n">alert</span> <span class="s2">&quot;document is ready to go!&quot;</span>
<span class="k">end</span>
</pre>
</div>

<p>The <code>Kernel#alert</code> method is shown above too.</p>

<h4>Event handling</h4>

<p>The <code>Element#on</code> method is used to attach event handlers to elements:</p>
<div class="highlight"><pre><span class="no">Document</span><span class="o">[</span><span class="s1">&#39;#header&#39;</span><span class="o">].</span><span class="n">on</span> <span class="ss">:click</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">&quot;The header was clicked!&quot;</span>
<span class="k">end</span>
</pre>
</div>

<p>Selectors can also be passed as a second argument to handle events
on certain children:</p>
<div class="highlight"><pre><span class="no">Document</span><span class="o">[</span><span class="s1">&#39;#header&#39;</span><span class="o">].</span><span class="n">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">,</span> <span class="s1">&#39;.foo&#39;</span><span class="p">)</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">&quot;An element with a &#39;foo&#39; class was clicked&quot;</span>
<span class="k">end</span>
</pre>
</div>

<p>An <code>Event</code> instance is optionally passed to block handlers as well,
which is toll-free bridged to jquery events:</p>
<div class="highlight"><pre><span class="no">Document</span><span class="o">[</span><span class="s1">&#39;#my_link&#39;</span><span class="o">].</span><span class="n">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">evt</span><span class="o">|</span>
  <span class="n">evt</span><span class="o">.</span><span class="n">stop_propagation</span>
  <span class="nb">puts</span> <span class="s2">&quot;stopped the event!&quot;</span>
<span class="k">end</span>
</pre>
</div>

<h4>CSS styles and classnames</h4>

<p>The various jquery methods are available on <code>Element</code> instances:</p>
<div class="highlight"><pre><span class="n">foo</span> <span class="o">=</span> <span class="no">Document</span><span class="o">[</span><span class="s1">&#39;.foo&#39;</span><span class="o">]</span>

<span class="n">foo</span><span class="o">.</span><span class="n">add_class</span> <span class="s1">&#39;blue&#39;</span>
<span class="n">foo</span><span class="o">.</span><span class="n">remove_class</span> <span class="s1">&#39;foo&#39;</span>
<span class="n">foo</span><span class="o">.</span><span class="n">toggle_class</span> <span class="s1">&#39;selected&#39;</span>
</pre>
</div>

<p>There are also added convenience methods for opal-jquery:</p>
<div class="highlight"><pre><span class="n">foo</span> <span class="o">=</span> <span class="no">Document</span><span class="o">[</span><span class="s1">&#39;#header&#39;</span><span class="o">]</span>

<span class="n">foo</span><span class="o">.</span><span class="n">class_name</span>
<span class="c1"># =&gt; &#39;red lorry&#39;</span>

<span class="n">foo</span><span class="o">.</span><span class="n">class_name</span> <span class="o">=</span> <span class="s1">&#39;yellow house&#39;</span>

<span class="n">foo</span><span class="o">.</span><span class="n">class_name</span>
<span class="c1"># =&gt; &#39;yellow house&#39;</span>
</pre>
</div>

<p><code>Element#css</code> also exists for getting/setting css styles:</p>
<div class="highlight"><pre><span class="n">el</span> <span class="o">=</span> <span class="no">Document</span><span class="o">[</span><span class="s1">&#39;#container&#39;</span><span class="o">]</span>
<span class="n">el</span><span class="o">.</span><span class="n">css</span> <span class="s1">&#39;color&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span>
<span class="n">el</span><span class="o">.</span><span class="n">css</span> <span class="s1">&#39;color&#39;</span>
<span class="c1"># =&gt; &#39;blue&#39;</span>
</pre>
</div>

<h3>HTTP/AJAX requests</h3>

<p>jQuery&#39;s Ajax implementation is also wrapped in the top level HTTP
class.</p>
<div class="highlight"><pre><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/1.json&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
  <span class="c1"># =&gt; &quot;{\&quot;name\&quot;: \&quot;Adam Beynon\&quot;}&quot;</span>
<span class="k">end</span>
</pre>
</div>

<p>The block passed to this method is used as the handler when the request
succeeds, as well as when it fails. To determine whether the request
was successful, use the <code>ok?</code> method:</p>
<div class="highlight"><pre><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/2.json&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok?</span>
    <span class="n">alert</span> <span class="s2">&quot;successful!&quot;</span>
  <span class="k">else</span>
    <span class="n">alert</span> <span class="s2">&quot;request failed :(&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>

<p>It is also possible to use a different handler for each case:</p>
<div class="highlight"><pre><span class="n">request</span> <span class="o">=</span> <span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/3.json&quot;</span><span class="p">)</span>

<span class="n">request</span><span class="o">.</span><span class="n">callback</span> <span class="p">{</span>
  <span class="nb">puts</span> <span class="s2">&quot;Request worked!&quot;</span>
<span class="p">}</span>

<span class="n">request</span><span class="o">.</span><span class="n">errback</span> <span class="p">{</span>
  <span class="nb">puts</span> <span class="s2">&quot;Request didn&#39;t work :(&quot;</span>
<span class="p">}</span>
</pre>
</div>

<p>The request is actually triggered inside the <code>HTTP.get</code> method, but due
to the async nature of the request, the callback and errback handlers can
be added anytime before the request returns.</p>

<h4>Handling responses</h4>

<p>Web apps deal with json responses quite frequently, so there is a useful
<code>#json</code> helper method to get the json content from a request:</p>
<div class="highlight"><pre><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users.json&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span>
<span class="k">end</span>

<span class="c1"># =&gt; &quot;[{\&quot;name\&quot;: \&quot;Adam\&quot;},{\&quot;name\&quot;: \&quot;Ben\&quot;}]&quot;</span>
<span class="c1"># =&gt; [{&quot;name&quot; =&gt; &quot;Adam&quot;}, {&quot;name&quot; =&gt; &quot;Ben&quot;}]</span>
</pre>
</div>

<p>The <code>#body</code> method will always return the raw response string.</p>

<p>If an error is encountered, then the <code>#status_code</code> method will hold the
specific error code from the underlying request:</p>
<div class="highlight"><pre><span class="n">request</span> <span class="o">=</span> <span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/3.json&quot;</span><span class="p">)</span>

<span class="n">request</span><span class="o">.</span><span class="n">callback</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">&quot;it worked!&quot;</span> <span class="p">}</span>

<span class="n">request</span><span class="o">.</span><span class="n">errback</span> <span class="p">{</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">&quot;failed with status </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">}</span>
</pre>
</div>

<p>opal-jquery provides DOM access to opal by wrapping jquery
and providing a nice ruby syntax for dealing with jquery instances.
opal-jquery is <a href="http://github.com/opal/opal-jquery">hosted on github</a>.</p>

<p>See the <a href="http://opal.github.com/opal-jquery">website for documentation</a>.</p>

<h3>Running Specs</h3>

<p>Get the dependencies:</p>
<div class="highlight"><pre>$ bundle install
</pre>
</div>

<p>Build dependencies, opal-jquery and it&#39;s specs into <code>build/</code>:</p>
<div class="highlight"><pre>$ rake opal
</pre>
</div>

<p>Run the tests inside a phantom.js runner:</p>
<div class="highlight"><pre>$ rake
</pre>
</div>

<h3>License</h3>

<p>Copyright (C) 2012 by Adam Beynon</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the &quot;Software&quot;), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.</p>
  </div>
</body>
</html>