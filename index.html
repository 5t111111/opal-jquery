<!DOCTYPE html>
<html>
<head>
  <title>opal-jquery</title>
  <link rel="stylesheet" href="css/bootstrap.css" type="text/css">
  <link rel="stylesheet" href="css/pygment_trac.css" type="text/css">
  <style>
    body {
      padding-top: 42px;
    }
  </style>
</head>
<body>
  <a href="https://github.com/opal/opal-jquery"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"></a>
  <div class="container">
    <div class="page-header">
      <h1>opal-jquery <small>jquery/zepto wrapper for opal</small></h1>
    </div><p>opal-jquery provides DOM access to opal by wrapping jquery (or zepto)
and providing a nice ruby syntax for dealing with jquery instances.
opal-jquery is <a href="http://github.com/opal/opal-jquery">hosted on github</a>.</p>

<p>jQuery instances are toll-free bridged to instances of the ruby class
<code>JQuery</code>, so they can be used interchangeably. The <code>Document</code> module also
exists, which provides the simple top level css selector method:</p>
<div class="highlight"><pre><span class="n">elements</span> <span class="o">=</span> <span class="no">Document</span><span class="o">[</span><span class="s1">&#39;.foo&#39;</span><span class="o">]</span>
<span class="c1"># =&gt; [&lt;div class=&quot;foo&quot;&gt;, ...]</span>

<span class="n">elements</span><span class="o">.</span><span class="n">class</span>
<span class="c1"># =&gt; JQuery</span>

<span class="n">elements</span><span class="o">.</span><span class="n">on</span><span class="p">(</span><span class="ss">:click</span><span class="p">)</span> <span class="k">do</span>
  <span class="n">alert</span> <span class="s2">&quot;element was clicked&quot;</span>
<span class="k">end</span>
</pre>
</div>

<h3>HTTP/AJAX requests</h3>

<p>jQuery&#39;s Ajax implementation is also wrapped in the top level HTTP
class.</p>
<div class="highlight"><pre><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/1.json&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
  <span class="c1"># =&gt; &quot;{\&quot;name\&quot;: \&quot;Adam Beynon\&quot;}&quot;</span>
<span class="k">end</span>
</pre>
</div>

<p>The block passed to this method is used as the handler when the request
succeeds, as well as when it fails. To determine whether the request
was successful, use the <code>ok?</code> method:</p>
<div class="highlight"><pre><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/2.json&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">ok?</span>
    <span class="n">alert</span> <span class="s2">&quot;successful!&quot;</span>
  <span class="k">else</span>
    <span class="n">alert</span> <span class="s2">&quot;request failed :(&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>

<p>It is also possible to use a different handler for each case:</p>
<div class="highlight"><pre><span class="n">request</span> <span class="o">=</span> <span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/3.json&quot;</span><span class="p">)</span>

<span class="n">request</span><span class="o">.</span><span class="n">callback</span> <span class="p">{</span>
  <span class="nb">puts</span> <span class="s2">&quot;Request worked!&quot;</span>
<span class="p">}</span>

<span class="n">request</span><span class="o">.</span><span class="n">errback</span> <span class="p">{</span>
  <span class="nb">puts</span> <span class="s2">&quot;Request didn&#39;t work :(&quot;</span>
<span class="p">}</span>
</pre>
</div>

<p>The request is actually triggered inside the <code>HTTP.get</code> method, but due
to the async nature of the request, the callback and errback handlers can
be added anytime before the request returns.</p>

<h4>Handling responses</h4>

<p>Web apps deal with json responses quite frequently, so there is a useful
<code>#json</code> helper method to get the json content from a request:</p>
<div class="highlight"><pre><span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users.json&quot;</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">body</span>
  <span class="nb">puts</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span>
<span class="k">end</span>

<span class="c1"># =&gt; &quot;[{\&quot;name\&quot;: \&quot;Adam\&quot;},{\&quot;name\&quot;: \&quot;Ben\&quot;}]&quot;</span>
<span class="c1"># =&gt; [{&quot;name&quot; =&gt; &quot;Adam&quot;}, {&quot;name&quot; =&gt; &quot;Ben&quot;}]</span>
</pre>
</div>

<p>The <code>#body</code> method will always return the raw response string.</p>

<p>If an error is encountered, then the <code>#status_code</code> method will hold the
specific error code from the underlying request:</p>
<div class="highlight"><pre><span class="n">request</span> <span class="o">=</span> <span class="no">HTTP</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;/users/3.json&quot;</span><span class="p">)</span>

<span class="n">request</span><span class="o">.</span><span class="n">callback</span> <span class="p">{</span> <span class="nb">puts</span> <span class="s2">&quot;it worked!&quot;</span> <span class="p">}</span>

<span class="n">request</span><span class="o">.</span><span class="n">errback</span> <span class="p">{</span> <span class="o">|</span><span class="n">response</span><span class="o">|</span>
  <span class="nb">puts</span> <span class="s2">&quot;failed with status </span><span class="si">#{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="p">}</span>
</pre>
</div>
  </div>
</body>
</html>